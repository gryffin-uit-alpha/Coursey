# Coursey Application Ingress
# This ingress provides a single entry point for all external traffic
# It routes requests to appropriate services based on URL paths
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: coursey-ingress
  labels:
    app: coursey
  annotations:
    # Enable URL rewriting and path-based routing
    nginx.ingress.kubernetes.io/rewrite-target: /
    # Handle CORS for API requests
    nginx.ingress.kubernetes.io/enable-cors: "true"
spec:
  # Define routing rules for different paths
  rules:
  - host: localhost  # Change to your domain in production
    http:
      paths:
      # Main application - routes to Nginx service port 80
      - path: /
        pathType: Prefix
        backend:
          service:
            name: nginx-service
            port:
              number: 80
      # Admin panel - routes to Nginx service port 8082
      - path: /admin
        pathType: Prefix
        backend:
          service:
            name: nginx-service
            port:
              number: 8082
      # API endpoints - routes directly to PHP service
      - path: /api
        pathType: Prefix
        backend:
          service:
            name: php-service
            port:
              number: 9000
      # Python admin backend - routes to Python service
      - path: /python
        pathType: Prefix
        backend:
          service:
            name: python-service
            port:
              number: 8002